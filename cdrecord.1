.\" @(#)cdrecord.1	1.1 96/02/04 Copyright 1996 J. Schilling
.\" 
.\" This is free documentation; you can redistribute it and/or
.\" modify it under the terms of the GNU General Public License as
.\" published by the Free Software Foundation; either version 2 of
.\" the License, or (at your option) any later version.
.\"
.\" The GNU General Public License's references to "object code"
.\" and "executables" are to be interpreted as the output of any
.\" document formatting or typesetting system, including
.\" intermediate and printed output.
.\"
.\" This manual is distributed in the hope that it will be useful,
.\" but WITHOUT ANY WARRANTY; without even the implied warranty of
.\" MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
.\" GNU General Public License for more details.
.\"
.\" You should have received a copy of the GNU General Public
.\" License along with this manual; if not, write to the Free
.\" Software Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139,
.\" USA.
.\"
.if t .ds a \v'-0.55m'\h'0.00n'\z.\h'0.40n'\z.\v'0.55m'\h'-0.40n'a
.if t .ds o \v'-0.55m'\h'0.00n'\z.\h'0.45n'\z.\v'0.55m'\h'-0.45n'o
.if t .ds u \v'-0.55m'\h'0.00n'\z.\h'0.40n'\z.\v'0.55m'\h'-0.40n'u
.if t .ds A \v'-0.77m'\h'0.25n'\z.\h'0.45n'\z.\v'0.77m'\h'-0.70n'A
.if t .ds O \v'-0.77m'\h'0.25n'\z.\h'0.45n'\z.\v'0.77m'\h'-0.70n'O
.if t .ds U \v'-0.77m'\h'0.30n'\z.\h'0.45n'\z.\v'0.77m'\h'-0.75n'U
.if t .ds s \\(*b
.if t .ds S SS
.if n .ds a ae
.if n .ds o oe
.if n .ds u ue
.if n .ds s sz
.TH CDRECORD 1 "Version 1.0" "J\*org Schilling" "Schily\'s USER COMMANDS"
.SH NAME
cdrecord \- record audio or data Compact Discs from a master
.SH SYNOPSIS
.B cdrecord
[
.I "general options
]
.BI dev= device
[
.I track options
]
.IR track1 .\|.\|. trackn

.SH DESCRIPTION
.B Cdrecord
is used to record data or audio Compact Discs on an Orange Book
CD-Recorder.
.PP
The
.I device
refers to
.IR scsibus / target / lun
of the CD-Recorder. Communication is done with the SCSI general driver
.B scg.
Possible syntax is:
.IR scsibus , target , lun
or
.IR target , lun .
In the latter case, the CD-Recorder has to be connected to the default 
SCSI bus of the machine.
.PP
.I Scsibus
,
.I target 
and 
.I lun
are integer numbers. 
.I Scsibus 
0 is the default SCSI bus on the machine. Watch the boot messages for more 
information or look into 
.B /var/adm/messages 
for more information about the SCSI configuration of your machine.
.PP
Each
.I track
corresponds to a single file that contains the prepared data for that track.
If the argument is 
.RB ` \- ',
standard input is used for that track.

.SH "GENERAL OPTIONS
.PP
General options must be before any track file name or track option.
.TP
.B \-v
Be verbose during work, display the progress of the writing process.
.TP
.B \-V
Be verbose in respect of SCSI command transport. This helps to debug problems
during the writing process, that occur in the CD-Recorder. 
If you get incomprehensible error messages you should use this flag
to get more detailed output.
.TP
.B \-dummy
The CD-Recorder will go through all steps of the recording process,
but the laser is turned off during this procedure.
It is recommended to run several tests before actually writing to a 
Compact Disk, if the timing and load response of the system is not known.
.TP
.B \-multi
Allow multi session CD's to be made. This flag needs to be present
on all sessions, except you want to create a session that will be 
the last session on the media.
The fixation will be done in a way that allows the CD-Recorder to
append additional sessions later. This is done by generation a TOC
with a link to the next program area. The so generated media is not
100%  compatible to manufactured CD's. 
Use only for recording a multi session CD.
.TP
.B \-fix
The disk will only be fixated (i.e. a TOC for a CD-Reader will be written). 
This may be used, if for some reason the disk has been written but not
fixated.
.TP
.B "speed=#
Set the speed factor of the writing process to #.
# is an integer, representing a multiple of the audio speed.
This is about 151 KB/s for CD-ROM and about 175 KB/s for CD-Audio.
.TP
.BI dev= target
Sets the SCSI target for the CD-Recorder, see notes above.

.SH "TRACK OPTIONS
.PP
Track options may be mixed with track file names.
.TP
.B \-audio
If this flag is present, all subsequent tracks are written in
CD-DA (similar to Red Book) audio format.
The file with data for this tracks should
contain stereo, 16-bit digital audio with 44100 samples/s.
The byte order should be the following: MSB left, LSB left, 
MSB right, LSB right, MSB left and so on. The track should be a multiple of 
2352 bytes. It is not possible to put audio data on a raw disk because 
data will be read in multiple of 2352 bytes during the recording process.
.TP
.B \-data
If this flag is present, all subsequent tracks are written in
CD-ROM (Yellow Book) format. The data is a multiple of 2048 bytes.
The file with track data should contain an 
.BR ISO-9660 " or " "Rock Ridge
filesystem image (see 
.B mkisofs
for more details). If the track data is an
.B ufs
filesystem image, fragment size should be set to 2 KB or more to allow
CR-drives with 2 KB sector size to to be used for reading.
.TP
.I " "
\-data is the default, if no other flag is present.
.TP
.B \-pad
Add 15 sectors of zeroed data to the end of each data track.
Use this if your CD-drive is not able to read the last sectors of
a track. This option only effects data tracks.
.TP
.B \-nopad
Do not pad data tracks \- the default.
.TP
.B \-preemp
If this flag is present, all TOC entries for subsequent audio tracks 
will indicate that the audio data has been sampled with 50/15 µsec
preemphasis.
The data, however is not modified during the process of transferring from file
to disk. 
This option has no effect on data tracks.
.TP
.B \-nopreemp
If this flag is present, all TOC entries for subsequent audio tracks 
will indicate that the audio data has been mastered with linear data \- 
this is the default.
.TP
.B bytes=#
If the image for the next track has been stored on a raw disk, use this option
to specify the valid amount of data on this disk. If the image of the next 
track is stored in a regular file, the size of that file is taken to determine
the length of this track.
The 
.B isosize
program, usually included in the
.B mkisofs
distribution, can be used to determine the length of an ISO 9660
filesystem image.

.SH EXAMPLES
.PP
For all examples below, it will be assumed that the CD-Recorder is
connected to the primary SCSI bus of the machine. The SCSI target id is
set to 2.
.PP
To record a pure CD-ROM at double speed, using data from the file
.IR cdimage.raw :
.PP
    priocntl \-e \-c RT \-p 59 cdrecord \-v speed=2 dev=2,0 cdimage.raw
.PP
To create an image for a ISO 9660 filesystem with Rock Ridge extensions:
.PP
    mkisofs \-R \-o cdimage.raw /home/joerg/master/tree
.PP
To check the resulting file before writing to CD:
.PP
    mount \-r \-F fbk \-o type=hsfs /dev/fbk0:cdimage.raw /mnt
.br
    ls \-lR /mnt
.br
    mount /mnt
.PP
To record a pure CD-DA (audio) at single speed, with each track contained
in a file named
.IR track01.cdaudio ,
.IR track02.cdaudio ,
etc:
.PP
    priocntl \-e \-c RT \-p 59 cdrecord \-v speed=1 dev=2,0 -audio track*.cdaudio
.PP
To check if it will be ok to use double speed for the example above. 
Use the dummy write option:
.PP
    priocntl \-e \-c RT \-p 59 cdrecord \-v \-dummy speed=2 dev=2,0 \-audio track*.cdaudio
.PP
To record a mixed-mode CD with an ISO 9660 filesystem from
.I cdimage.raw
on the first track, the other tracks being audio tracks from the files
.IR track01.cdaudio ,
.IR track02.cdaudio ,
etc:
.PP
    priocntl \-e \-c RT \-p 59 cdrecord \-v \-dummy dev=2,0 cdimage.raw \-audio track*.cdaudio

.SH SEE ALSO
.BR mkisofs (1),
.BR scg (7),
.BR fbk (7).

.SH NOTES
The current version of
.B cdrecord
will only record
.B "track at once
Yellow Book Compatible Discs.
If the so made disks contain more than one track,
they are not suitable for direct mass production by CD manufacturers.
You will need the 
.B "disk at once
option to record such disks.
Nevertheless the disks made with
.B cdrecord
will normally be read in all CD players. Some old
players however may produce a two second click between two audio tracks.
.PP
You should not use the 
.B \-multi
flag, unless you know that you really want to create a multi session CD.
As 
.B cdrecord 
currently has no support to retrieve the first writable address for the 
next session, multi session CD's are currently not possible. We will need
a modified 
.B mkisofs
to do this according the Kodak Photo-CD spec.
.PP
.B Cdrecord
has been tested on a Philips CDD-521 recorder at single and double speed
on a SparcStation 20/502 with no problems, slower models should work also. 
The newer Philips/HP/Plasmon/Grundig
drives should work also, Yamaha may work (test it).
.PP
You should run several tests in single and double speed with the
.B \-dummy
option turned on if you are using 
.B cdrecord
on an unknown system. Writing a CD is a realtime process. I used
.B cdrecord 
with with medium load on a SS20/502, but it is recommended to leave the system
as lightly loaded as possible while writing a CD.
.B Cdrecord
needs to run as root to get access to the 
.B /dev/scg?
device nodes and to be able to lock itself into memory.
.PP
You should not connect old drives that do not support
disconnect/reconnect to either the SCSI bus that is connected to the
CD-Recorder or the source disk.
.PP
A Compact Disc can have no more than 99 tracks.
.PP
When creating a disc with both audio and data tracks, 
the data should be on track 1. CDplus has not yet been tested.
.PP
Many systems are not able to read more than a single data track, or
need special software to do so.
.PP
More information on the SCSI command set of a HP CD-Recorder can be found at:
.PP
	http://hpcc80.external.hp.com/Publish/isg/cdr/commandset/Index.html
.PP
If you have more information or SCSI command manuals for other CD-Recorders
than Philips CDD 522 or the HP drive mentioned above please contact the author.
.PP
The Philips CDD 521 CD-Recorder has several firmware bugs. Some of them will
force you to power cycle the device or to reboot the machine.

.SH DIAGNOSTICS
.PP
You have 5 seconds to type ^C to abort 
.B cdrecord
after you see the message:
.PP
Starting to write CD at speed %d in %s mode for %s session.
.PP
A typical error message for a SCSI command looks like:
.sp
.RS
.nf
cdrecord: I/O error. test unit ready: scsi sendcmd: no error
status: 0x2 (CHECK CONDITION)
Sense Bytes: 70 00 05 00 00 00 00 0A 00 00 00 00 25 00 00 00 00 00
Sense Key: 0x5 Illegal Request, Code 0x25 (invalid lun) blk 0
.fi
.sp
.RE
The first line gives information about the transport of the command.
The text after the first colon gives the error text for the system call
from the view of the kernel. It usually is:
.B "I/O error
unless other problems happen. The next words contain a short description for
the SCSI command that fails. The rest of the line tell you if there were
any problems for the transport of the command over the SCSI bus.
.B "fatal error
means that it was not possible to transport the command (i.e. no device present
at the requested SCSI address).
.PP
The second line gives information on the SCSI status code returned by the 
command, if the transport of the command succeeds. 
This is error information from the SCSI device.
.PP
The third line is a hex dump of the auto request sense information for the 
command.
.PP
The fourth line is the error text for the sense bytes if available.
If the type of the device is known, the sense data is decoded from tables
in
.IR scsierrs.c " .

.SH BUGS
.PP
.B Cdrecord
should verify that the input data will fit on the media. Currently you get
unpredictable results in this case.
.PP
There should be an option to write index numbers for audio tracks.
.PP
There should be a recover option to make disks usable, that have been written
during a power failure.

.SH AUTHOR
.nf
J\*org Schilling
Seestr. 110
D-13353 Berlin
Germany
.fi
.PP
Mail bugs and suggestions to:
.PP
.B
joerg@schily.isdn.cs.tu-berlin.de
or
.B
js@cs.tu-berlin.de
or
.B
jes@fokus.gmd.de
