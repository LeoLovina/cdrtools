*** mkisofs.c.bak	Wed Feb 18 05:50:47 1998
--- mkisofs.c	Sun Mar 29 12:58:26 1998
***************
*** 91,96 ****
--- 91,98 ----
  int follow_links = 0;
  int rationalize = 0;
  int generate_tables = 0;
+ int print_size = 0;
+ int split_output = 0;
  char * preparer = PREPARER_DEFAULT;
  char * publisher = PUBLISHER_DEFAULT;
  char * appid = APPID_DEFAULT;
***************
*** 162,167 ****
--- 164,171 ----
  #define OPTION_QUIET			151
  #define OPTION_NOSPLIT_SL_COMPONENT	152
  #define OPTION_NOSPLIT_SL_FIELD		153
+ #define OPTION_PRINT_SIZE		154
+ #define OPTION_SPLIT_OUTPUT		155
  
  static const struct ld_option ld_options[] =
  {
***************
*** 205,210 ****
--- 209,216 ----
        'o', "FILE", "Set output file name" , ONE_DASH },
    { {"preparer", required_argument, NULL, 'p'},
        'p', "PREP", "Set Volume preparer" , ONE_DASH },
+   { {"print-size", no_argument, NULL, OPTION_PRINT_SIZE},
+       '\0', NULL, "Print estimated filesystem size and exit", ONE_DASH },
    { {"publisher", required_argument, NULL, 'P'},
        'P', "PUB", "Set Volume publisher" , ONE_DASH },
    { {"quiet", no_argument, NULL, OPTION_QUIET},
***************
*** 213,218 ****
--- 219,226 ----
        'r', NULL, "Generate rationalized Rock Ridge directory information", ONE_DASH },
    { {"rock", no_argument, NULL, 'R'},
        'R', NULL, "Generate Rock Ridge directory information", ONE_DASH },
+   { {"split-output", no_argument, NULL, OPTION_SPLIT_OUTPUT},
+       '\0', NULL, "Split output into files of approx. 1GB size", ONE_DASH },
    { {"translation-table", no_argument, NULL, 'T'},
        'T', NULL, "Generate translation tables for systems that don't understand long filenames", ONE_DASH },
    { {"verbose", no_argument, NULL, 'v'},
***************
*** 673,678 ****
--- 681,689 ----
  		exit(1);
  	};
  	break;
+       case OPTION_PRINT_SIZE:
+ 	print_size++;
+ 	break;
        case 'P':
  	publisher = optarg;
  	if(strlen(publisher) > 128) {
***************
*** 690,695 ****
--- 701,709 ----
  	rationalize++;
  	use_RockRidge++;
  	break;
+       case OPTION_SPLIT_OUTPUT:
+ 	split_output++;
+ 	break;
        case 'T':
  	generate_tables++;
  	break;
***************
*** 998,1004 ****
    /*
     * OK, ready to write the file.  Open it up, and generate the thing.
     */
!   if (outfile){
  	  discimage = fopen(outfile, "w");
  	  if (!discimage){
  		  fprintf(stderr,"Unable to open disc image file\n");
--- 1012,1024 ----
    /*
     * OK, ready to write the file.  Open it up, and generate the thing.
     */
!   if (print_size){
! 	  discimage = fopen("/dev/null", "w");
! 	  if (!discimage){
! 		  fprintf(stderr,"Unable to open /dev/null\n");
! 		  exit(1);
! 	  }
!   } else if (outfile){
  	  discimage = fopen(outfile, "w");
  	  if (!discimage){
  		  fprintf(stderr,"Unable to open disc image file\n");
***************
*** 1028,1046 ****
    outputlist_insert(&voldesc_desc);
  
    /*
!    * SVD for Joliet.
     */
!   if( use_Joliet)
      {
!       outputlist_insert(&joliet_desc);
      }
  
    /*
!    * SVD for El Torito.
     */
!   if( use_eltorito)
      {
!       outputlist_insert(&torito_desc);
      }
  
    /*
--- 1048,1066 ----
    outputlist_insert(&voldesc_desc);
  
    /*
!    * SVD for El Torito. MUST be immediately after the PVD!
     */
!   if( use_eltorito)
      {
!       outputlist_insert(&torito_desc);
      }
  
    /*
!    * SVD for Joliet.
     */
!   if( use_Joliet)
      {
!       outputlist_insert(&joliet_desc);
      }
  
    /*
