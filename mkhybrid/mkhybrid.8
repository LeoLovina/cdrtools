'\" t
.\" To print, first run through tbl
.\" THIS FILE HAS BEEN AUTOMATICALLY GENERATED.  DO NOT EDIT
.\" -*- nroff -*-
.\" @(#)mkhybrid.8	1.50 00/04/27 joerg
.\"
.if t .ds a \v'-0.55m'\h'0.00n'\z.\h'0.40n'\z.\v'0.55m'\h'-0.40n'a
.if t .ds o \v'-0.55m'\h'0.00n'\z.\h'0.45n'\z.\v'0.55m'\h'-0.45n'o
.if t .ds u \v'-0.55m'\h'0.00n'\z.\h'0.40n'\z.\v'0.55m'\h'-0.40n'u
.if t .ds A \v'-0.77m'\h'0.25n'\z.\h'0.45n'\z.\v'0.77m'\h'-0.70n'A
.if t .ds O \v'-0.77m'\h'0.25n'\z.\h'0.45n'\z.\v'0.77m'\h'-0.70n'O
.if t .ds U \v'-0.77m'\h'0.30n'\z.\h'0.45n'\z.\v'0.77m'\h'-0.75n'U
.if t .ds s \\(*b
.if t .ds S SS
.if n .ds a ae
.if n .ds o oe
.if n .ds u ue
.if n .ds s sz
.TH MKHYBRID 8 "26 April 2000" "Version 1.12.1"
.SH NAME
mkhybrid \- create an hybrid ISO9660/JOLIET/HFS filesystem with optional Rock Ridge attributes.
.SH SYNOPSIS
.B mkhybrid
[
.B \-abstract
.I FILE
]
[
.B \-allow-lowercase
]
[
.B \-allow-multidot
]
[
.B \-biblio
.I FILE
]
[
.B \-b
.I eltorito_boot_image
]
[
.B \-B
.I sparc_boot_image_list
]
[
.B \-G
.I generic_boot_image
]
[
.B \-gui
]
[
.B \-C
.I #,#
]
[
.B \-hard-disk-boot
]
[
.B \-no-emul-boot
]
[
.B \-no-boot
]
[
.B \-boot-load-seg
]
[
.B \-boot-load-size
]
[
.B \-boot-info-table
]
[
.B \-c
.I boot_catalog
]
[
.B \-check-oldnames
]
[
.B \-copyright
.I FILE
]
[
.B \-A
.I application_id
]
[
.B \-f
]
[
.B \-d
]
[
.B \-D
]
[
.B \-hide
.I glob
]
[
.B \-hide-list
.I file
]
[
.B \-hidden
.I glob
]
[
.B \-hidden-list
.I file
]
[
.B \-hide-joliet
.I glob
]
[
.B \-hide-joliet-list
.I file
]
[
.B \-hide-joliet-trans-tbl
]
[
.B \-hide-rr-moved
]
[
.B \-iso-level
.I level
]
[
.B \-J
]
[
.B \-jcharset
.I charset
]
[
.B \-l
]
[
.B \-L
]
[
.B \-log-file
.I log_file
]
[
.B \-max-iso9660-filenames
]
[
.B \-M
.I path | device
]
[
.B \-nobak
]
[
.B \-no-bak
]
[
.B \-no-split-symlink-components
]
[
.B \-no-split-symlink-fields
]
[
.B \-pad
]
[
.B \-path-list
.I file
]
[
.B \-p
.I preparer
]
[
.B \-print-size
]
[
.B \-P
.I publisher
]
[
.B \-quiet
]
[
.B \-r
]
[
.B \-R
]
[
.B \-relaxed-filenames
]
[
.B \-sort
.I "sort file
]
[
.B \-sysid
.I ID
]
[
.B \-T
|
.B \-table-name
.I TABLE_NAME
]
[
.B \-ucs-level
.I level
]
[
.B \-use-fileversion
]
[
.B \-U
]
[
.B \-no-iso-translate
]
[
.B \-v
]
[
.B \-V
.I volid
]
[
.B \-volset
.I ID
]
[
.B \-volset-size
.I #
]
[
.B \-volset-seqno
.I #
]
[
.B \-x
.I path
]
[
.B \-exclude-list
.I file
]
[
.B \-z
]
[
.B \-m
.I glob
]
[
.B \-hfs
|
.B \-apple
]
[
.B \-map
.I mapping_file
]
[
.B \-magic
.I magic_file
]
[
.B \-probe
]
[
.B \-no-desktop
]
[
.B \-mac-name
]
[
.B \-boot-hfs-file
.I driver_file
[
.B \-part
]
[
.B \-auto
.I AutoStart_file
]
[
.B \-cluster-size
.I size
]
[
.B \-hide-hfs
.I glob
]
[
.B \-hide-hfs-list
.I file
]
[
.B \-hfs-volid
.I hfs_volid
]
[
.B \-icon-position
]
[
.B \-root-info
.I FILE
[
.B \-prep-boot
.I FILE
]
[
.B \-hfs-creator
.I CREATOR
]
[
.B \-hfs-type
.I TYPE
]
[
.B \--cap
]
[
.B \--netatalk
]
[
.B \--double
]
[
.B \--ethershare
]
[
.B \--ushare
]
[
.B \--exchange
]
[
.B \--sgi
]
[
.B \--xinet
]
[
.B \--macbin
]
[
.B \--single
]
[
.B \--dave
]
[
.B \--sfm
]
.B \-o
.I filename
.I pathspec [pathspec]
.SH DESCRIPTION
.B mkhybrid
is effectively a pre-mastering program to generate an HFS/ISO9660/JOLIET hybrid
filesystem. It is based on
.BR m\&kisofs (1)
and will generate a pure ISO9660 filesystem unless the HFS hybrid command
line options are given.
.PP
.B mkhybrid
can generate a 
.I true
(or
.IR shared )
HFS hybrid filesystem. The same files are seen as HFS files when
accessed from a Macintosh and as ISO9660 files when accessed from other 
machines. HFS stands for
.I Hierarchical File System
and is the native file system used on Macintosh computers.
.PP
As an alternative,
.B mkhybrid
can generate the
.I Apple Entensions to ISO9660
for each file. These extensions provide each file with CREATOR, TYPE and
certain Finder Flags when accessed from a Macintosh. See the
.B MACINTOSH FILE FORMATS
section below.
.PP
.B mkhybrid
takes a snapshot of a given directory tree, and generates a
binary image which will correspond to an ISO9660 or HFS filesystem when
written to a block device.
.PP
.B mkhybrid
is also capable of generating the System Use Sharing Protocol records specified
by the Rock Ridge Interchange Protocol.  This is used to further describe the
files in the iso9660 filesystem to a unix host, and provides information such
as longer filenames, uid/gid, posix permissions, and block and character
devices.
.PP
Each file written to the iso9660 filesystem must have a filename in the 8.3
format (8 characters, period, 3 characters, all upper case), even if Rock Ridge
is in use.  This filename is used on systems that are not able to make use of
the Rock Ridge extensions (such as MS-DOS), and each filename in each directory
must be different from the other filenames in the same directory.
.B mkhybrid
generally tries to form correct names by forcing the unix filename to upper
case and truncating as required, but often times this yields unsatisfactory
results when there are cases where the
truncated names are not all unique.
.B mkhybrid
assigns weightings to each filename, and if two names that are otherwise the
same are found the name with the lower priority is renamed to have a 3 digit
number as an extension (where the number is guaranteed to be unique).  An
example of this would be the files foo.bar and
foo.bar.~1~ - the file foo.bar.~1~ would be written as FOO.000;1 and the file
foo.bar would be written as FOO.BAR;1
.PP
When used with various HFS options,
.B mkhybrid
will attempt to recognise files stored in a number of Apple/Unix file formats
and will copy the data and resource forks as well as any
relevant finder information. See the
.B MACINTOSH FILE FORMATS
section below for more about formats
.B mkhybrid
supports.
.PP
Note that
.B mkhybrid
is not designed to communicate with the writer directly.  Most writers
have proprietary command sets which vary from one manufacturer to
another, and you need a specialized tool to actually burn the disk.
The
.B cdwrite
utility is one such tool that runs under Linux and performs this task.
The latest version of
.B cdwrite
is capable of communicating with the Phillips/IMS/Kodak, HP and Yamaha drives
that have been manufactured before 1997.
Most writers come with some version of DOS software that allows a direct image
copy of an iso9660 image to the writer.  The current version of
.B cdwrite
is available from ftp://sunsite.unc.edu/utils/disk-management/cdwrite-2.0.tar.gz
Note that cdwrite has not been actively maintained since 1995.
.PP
The
.B
cdrecord
utility is another utility capable of burning an actual disc.  The latest version
of
.B cdrecord
is available from
ftp://ftp.fokus.gmd.de/pub/unix/cdrecord
Cdrecord is under constant development.
.PP
Also you should know that most cd writers are very particular about timing.
Once you start to burn a disc, you cannot let their buffer empty before you
are done, or you will end up with a corrupt disc.  Thus it is critical
that you be able to maintain an uninterrupted data stream to the writer
for the entire time that the disc is being written.
.PP
.br
.B pathspec
is the path of the directory tree to be copied into the iso9660 filesystem.
Multiple paths can be specified, and
.B
mkhybrid
will merge the files found in all of the specified path components to form the cdrom
image.
.PP
It is possible to graft the paths at points other than the root
directory, and it is possible to graft files or directories onto the
cdrom image with names different than what they have in the source filesystem.  This is
easiest to illustrate with a couple of examples.   Let's start by assuming that a local
file ../old.lis exists, and you wish to include it in the cdrom image.


	foo/bar/=../old.lis

will include the file old.lis in the cdrom image at /foo/bar/old.lis, while

	foo/bar/xxx=../old.lis

will include the file old.lis in the cdrom image at /foo/bar/xxx.  The
same sort of syntax can be used with directories as well.
.B mkhybrid
will create any directories required such that the graft
points exist on the cdrom image - the directories do not need to
appear in one of the paths.  Any directories that are created on the
fly like this will have permissions 0555 and appear to be owned by the
person running mkhybrid.  If you wish other permissions or owners of
the intermediate directories, the easiest solution is to create real
directories in the path such that mkhybrid doesn't have to invent them.
.PP
.B mkhybrid
will also run on Win9X/NT4 machines when compiled with Cygnus' cygwin
(available from http://sourceware.cygnus.com/cygwin/). Therefore most
references in this man page to
.I Unix
can be replaced with
.IR Win32 .

.SH OPTIONS
.TP
.BI \-abstract " FILE
Specifies the abstract file name.
This parameter can also be set in the file
.B \&.m\&kisofsrc
with ABST=filename.
If specified in both places, the command line version is used.
.TP
.BI \-A " application_id
Specifies a text string that will be written into the volume header.
This should describe the application that will be on the disc.  There
is space on the disc for 128 characters of information.  This parameter can
also be set in the file
.B \&.m\&kisofsrc
with APPI=id.
If specified in both places, the command line version is used.
.TP
.B \-allow-lowercase
This options allows lower case characters to appear in iso9660 filenames.
.br
This violates the ISO9660 standard, but it happens to work on some systems.
Use with caution.
.TP
.B \-allow-multidot
This options allows more than one dot to appear in iso9660 filenames.
A leading dot is not affected by this option, it
may be allowed separately using the
.B \-L
option.
.br
This violates the ISO9660 standard, but it happens to work on many systems.
Use with caution.
.TP
.BI \-biblio " FILE
Specifies the bibliographic file name.
This parameter can also be set in the file
.B \&.m\&kisofsrc
with BIBLO=filename.
If specified in both places, the command line version is used.
.TP
.BI \-b " eltorito_boot_image
Specifies the path and filename of the boot image to be used when making
an "El Torito" bootable CD. The pathname must be relative to the source
path specified to
.B mkhybrid.
This option is required to make an "El Torito" bootable CD.
The boot image must be exactly the size of either a 1.2, 1.44, or a 2.88
meg floppy, and
.B mkhybrid
will use this size when creating the output iso9660
filesystem. It is assumed that the first 512 byte sector should be read
from the boot image (it is essentially emulating a normal floppy drive).
This will work, for example, if the boot image is a LILO based boot floppy.
.TP
.BI \-B " img_sun4,img_sun4c,img_sun4m,img_sun4d,img_sun4e
Specifies a comma separated list of boot images that are needed to make
a bootable CD for sparc systems.
There may be empty fields in the comma separated list.
This option is required to make a bootable CD for Sun sparc systems.
If the
.B \-B
or
.B \-sparc-boot
option has been specified, the first sector of the resulting image will
contain a Sun disk label. This disk label specifies slice 0 for the
iso9660 image and slice 1 .\|.\|. slice 7 for the boot images that
have been specified with this option. Byte offset 512 .\|.\|. 8191
within each of the additional boot images must contain a primary boot
that works for the appropriate sparc architecture. The rest of each
of the images usually contains an ufs filesystem that is used primary
kernel boot stage.
.sp
The implemented boot method is the boot method found with SunOS 4.x and SunOS 5.x.
However, it does not depend on SunOS internals but only on properties of
the Open Boot prom. For this reason, it should be usable for any OS
that boots off a sparc system.
.sp
If the special filename
.B "..."
is used, the actual and all following boot partitions are mapped to the
previous partition. If
.B mkhybrid
is called with
.BI "\-G " image " \-B " ...
all boot partitions are mapped to the partition that contains the iso9660
filesystem image and the generic boot image that is located in the first
16 sectors of the disk is used for all architectures.
.TP
.BI \-G " generic_boot_image
Specifies the path and filename of the generic boot image to be used when making
a generic bootable CD.
The
.B generic_boot_image
will be placed on the first 16 sectors of the CD. The first 16 sectors
are the sectors that are located before the iso9660 primary volume descriptor.
If this option is used together with the
.B \-sparc-boot
option, the Sun disk label will overlay the first 512 bytes of the generic
boot image.
.TP
.BI \-hard-disk-boot
Specifies that the boot image used to create "El Torito" bootable CDs is
a hard disk image. The hard disk image must begin with a master boot
record that contains a single partition.
.TP
.BI \-no-emul-boot
Specifies that the boot image used to create "El Torito" bootable CDs is
a 'no emulation' image. The system will load and execute this image without
performing any disk emulation.
.TP
.BI \-no-boot
Specifies that the created "El Torito" CD should be marked as not bootable. The
system will provide an emulated drive for the image, but will boot off
a standard boot device.
.TP
.BI \-boot-load-seg " segment_address
Specifies the load segment address of the boot image for no-emulation
"El Torito" CDs.
.TP
.BI \-boot-load-size " load_sectors
Specifies the number of "virtual" (512-byte) sectors to load in
no-emulation mode.  The default is to load the entire boot file.  Some
BIOSes may have problems if this is not a multiple of 4.
.TP
.BI \-boot-info-table
Specifies that a 56-byte table with information of the CD-ROM layout
will be patched in at offset 8 in the boot file.  If this option is
given, the boot file is modified in the source filesystem, so make
sure to make a copy if this file cannot be easily regenerated!  See
the
.B " BOOT INFO TABLE
section for a description of this table.
.TP
.BI \-C " last_sess_start,next_sess_start
This option is needed when
.B mkhybrid
is used to create the image of a second session or a higher level session
for a multi session disk.
The option
.B \-C
takes a pair of two numbers separated by a comma. The first number is the
sector number of the first sector in the last session of the disk
that should be appended to.
The second number is the starting sector number of the new session.
The expected pair of numbers may be retrieved by calling
.B "cdrecord \-msinfo ...
the
.B \-C
option may only be uses in conjunction with the
.B \-M
option.
.TP
.BI \-c " boot_catalog
Specifies the path and filename of the boot catalog to be used when making
an "El Torito" bootable CD. The pathname must be relative to the source
path specified to
.B mkhybrid.
This option is required to make a bootable CD.
This file will be inserted into the output tree and not created
in the source filesystem, so be
sure the specified filename does not conflict with an existing file, as
it will be excluded. Usually a name like "boot.catalog" is
chosen.
.TP
.B \-check-oldnames
Check all filenames imported from old session for compliance with
actual 
.B mkhybrid 
iso9660 file naming rules.
It his option is not present, only names with a length > 31 are checked
as these files are a hard violation of the iso9660 standard.
.TP
.BI \-copyright " FILE
Specifies the Copyright file name.
This parameter can also be set in the file
.B \&.m\&kisofsrc
with COPY=filename.
If specified in both places, the command line version is used.
.TP
.B \-d
Omit trailing period from files that do not have a period.
.br
This violates the ISO9660 standard, but it happens to work on many systems.
Use with caution.
.TP
.B \-D
Do not use deep directory relocation, and instead just pack them in the
way we see them.
.br
This violates the ISO9660 standard, but it happens to work on many systems.
Use with caution.
.TP
.B \-f
Follow symbolic links when generating the filesystem.  When this option is not
in use, symbolic links will be entered using Rock Ridge if enabled, otherwise
the file will be ignored.
.TP
.B \-gui
Switch the behaviour for a GUI. This currently makes the output more verbose
but may have other effects in future.
.TP
.BI \-hide " glob
Hide
.I glob
from being seen on the ISO9660 or Rock Ridge directory.
.I glob
is a shell wild-card-style pattern that must match any part of the filename 
or path.
Multiple globs may be hidden.
If
.I glob
matches a directory, then the contents of that directory will be hidden.
All the hidden files will still be written to the output CD image file.
Should be used with the
.B \-hide-joliet
option.
.TP
.BI \-hide-list " file
A file containing a list of
.I globs
to be hidden as above.
.TP
.BI \-hidden " glob
Add the hidden (existence) ISO9660 directory attribute for
.IR glob .
This attribute will prevent 
.I glob
from being listed on DOS based systems if the /A flag is not used for the listing.
.I glob
is a shell wild-card-style pattern that must match any part of the filename 
or path.
Multiple globs may be hidden.
.TP
.BI \-hidden-list " file
A file containing a list of
.I globs
to get the hidden attribute as above.
.TP
.BI \-hide-joliet " glob
Hide
.I glob
from being seen on the Joliet directory.
.I glob
is a shell wild-card-style pattern that must match any part of the filename 
or path.
Multiple globs may be hidden.
If
.I glob
matches a directory, then the contents of that directory will be hidden.
All the hidden files will still be written to the output CD image file.
Should be used with the
.B \-hide
option.
.TP
.BI \-hide-joliet-list " file
A file containing a list of
.I globs
to be hidden as above.
.TP
.B \-hide-joliet-trans-tbl
Hide the
.B TRANS.TBL
files from the Joliet tree.
These files usually don't make sense in the Joliet World as they list
the real name and the ISO9660 name which may both be different from the
Joliet name.
.TP
.B \-hide-rr-moved
Rename the directory
.B RR_MOVED
to
.B .rr_moved
in the Rock Ridge tree.
It seems to be impossible to completely hide the
.B RR_MOVED
directory from the Rock Ridge tree.
This option only makes the visible tree better to understand for
people who don't know what this directory is for.
If you need to have no
.B RR_MOVED
directory at all, you should use the
.B \-D
option. Note that in case that the
.B \-D
option has been specified, the resulting filesystem is not ISO9660
level-1 compliant and will not be readable on MS-DOS.
.TP
.B \-l
Allow full 31 character filenames.  Normally the ISO9660 filename will be in an
8.3 format which is compatible with MS-DOS, even though the ISO9660 standard
allows filenames of up to 31 characters.  If you use this option, the disc may
be difficult to use on a MS-DOS system, but this comes in handy on some other
systems (such as the Amiga).  Use with caution.
.TP
.BI \-iso-level " level
Set the iso9660 conformance level. Valid numbers are 1..3.
.sp
With level 1, no associated files are allowed and filenames are
restricted to 8.3 characters.
.sp
With level 2, no associated files are allowed.
.sp
With level 3, no restrictions apply.
.sp
With all iso9660 levels all filenames are restricted to upper
case letters, numbers and the underscore (_). The maximum filename
length is restricted to 31 characters, the directory nesting level
is restricted to 8 and the maximum path length is limited to 255 characters.
.TP
.B \-J
Generate Joliet directory records in addition to regular iso9660 file
names.  This is primarily useful when the discs are to be used on Windows-NT
or Windows-95 machines.   The Joliet filenames are specified in Unicode and
each path component can be up to 64 Unicode characters long.
.TP
.BI \-jcharset " charset
Local charset that should be used for translating local file names into
Joliet Unicode directory records.
To get a list of valid charset names, call
.B "mkhybrid \-jcharset help.
To get a 1:1 mapping, you may use
.B default
as charset name. The default initial values are
.I cp437
on DOS based systems and
.I iso8859-1
on all other systems.
If the
.B \-jcharset
option is specified, the
.B \-J
option is implied.
.TP
.B \-L
Allow ISO9660 filenames to begin with a period.  Usually, a leading dot is
replaced with an underscore in order to maintain MS-DOS compatibility.
.br
This violates the ISO9660 standard, but it happens to work on many systems.
Use with caution.
.TP
.BI \-log-file " log_file
Redirect all error, warning and informational messages to
.I log_file
instead of the standard error.
.TP
.BI \-m " glob
Exclude
.I glob
from being written to CDROM.
.I glob
is a shell wild-card-style pattern that must match part of the filename (not 
the path as with option
.BR \-x ).
Technically
.I glob
is matched against the
.I d->d_name
part of the directory entry.
Multiple globs may be excluded.
Example:

mkhybrid \-o rom \-m '*.o' \-m core \-m foobar

would exclude all files ending in ".o", called "core" or "foobar" to be
copied to CDROM. Note that if you had a directory called "foobar" it too (and
of course all its descendants) would be excluded.
.sp
NOTE: The \-m and \-x option description should both be updated, they are wrong.
Both now work identical and use filename globbing. A file is excluded if either
the last component matches or the whole path matches.
.TP
.BI \-exclude-list " file
A file containing a list of
.I globs
to be exclude as above.
.TP
.B \-max-iso9660-filenames
Allow 37 chars in iso9660 filenames.
This option forces the
.B \-N
option as the extra name space is taken from the space reserved for
ISO-9660 version numbers.
.br
This violates the ISO9660 standard, but it happens to work on many systems.
Although a conforming application needs to provide a buffer space of at
least 37 characters, disks created with this option may cause a buffer
overflow in the reading operating system. Use with extreme care.
.TP
.BI \-M " path
or
.TP
.BI \-M " device
Specifies path to existing iso9660 image to be merged. The alternate form
takes a SCSI device specifier that uses the same syntax as the
.B "dev=
parameter of
.B cdrecord.
The output of 
.B mkhybrid
will be a new session which should get written to the end of the
image specified in \-M.  Typically this requires multi-session capability
for the recorder and cdrom drive that you are attempting to write this
image to.
This option may only be used in conjunction with the
.B \-C
option.
.TP
.B \-N
Omit version numbers from ISO9660 file names.
.br
This violates the ISO9660 standard, but no one really uses the
version numbers anyway.
Use with caution.
.TP
.B \-nobak
.TP
.B \-no-bak
Do not include backup files files on the iso9660 filesystem.
If the
.B \-no-bak
option is specified, files that contain the characters '~' or '#'
or end in '.bak' will not be included (these are typically backup files
for editors under unix).
.TP
.B \-no-rr
Do not use the Rock Ridge attributes from previous sessions.
This may help to avoid getting into trouble when
.B mkhybrid
finds illegal Rock Ridge signatures on an old session.
.TP
.B \-no-split-symlink-components
Don't split the SL components, but begin a new Continuation Area (CE)
instead. This may waste some space, but the SunOS 4.1.4 cdrom driver
has a bug in reading split SL components (link_size = component_size 
instead of link_size += component_size).
.TP
.B \-no-split-symlink-fields
Don't split the SL fields, but begin a new Continuation Area (CE)
instead. This may waste some space, but the SunOS 4.1.4 and
Solaris 2.5.1 cdrom driver have a bug in reading split SL fields
(a `/' can be dropped).
.TP
.BI \-o " filename
is the name of the file to which the iso9660 filesystem image should be
written.  This can be a disk file, a tape drive, or it can correspond directly
to the device name of the optical disc writer.  If not specified, stdout is
used.  Note that the output can also be a block special device for a regular
disk drive, in which case the disk partition can be mounted and examined to
ensure that the premastering was done correctly.
.TP
.B \-pad
Pad the end of the ISO9660 by 16 sectors (32kB). If the total size then
is not a multiple of 16 sectors, the needed number of sectors is added.
If the option
.B \-B
is used, then there is a second padding at the end of the boot partitions.
.sp
The padding is neded as many operating systems (e.g. Linux)
implement read ahead bugs in their filesystem I/O. These bugs result in read
errors on one or more files that are located at the end of a track. They are
usually present when the CD is written in Track at Once mode or when
the disk is written as mixed mode CD where an audio track follows the
data track.
.TP
.BI \-path-list " file
A file containing a list of
.I pathspec
directories and filenames to be added to the ISO9660 filesystem. This list
of pathspecs are processed after any that appear on the command line. If the
argument is
.IR \- ,
then the list is read from the standard input. There must be at least one
.I pathspec
given on the command line as well.
.TP
.BI \-P " publisher_id
Specifies a text string that will be written into the volume header.
This should describe the publisher of the CDROM, usually with a
mailing address and phone number.  There is space on the disc for 128
characters of information.  This parameter can also be set in the file
.B \&.m\&kisofsrc
with PUBL=.
If specified in both places, the command line version is used.
.TP
.BI \-p " preparer_id
Specifies a text string that will be written into the volume header.
This should describe the preparer of the CDROM, usually with a mailing
address and phone number.  There is space on the disc for 128
characters of information.  This parameter can also be set in the file
.B \&.m\&kisofsrc
with PREP=.
If specified in both places, the command line version is used.
.TP
.B \-print-size
Print estimated filesystem size and exit. This option is needed for
Disk At Once mode and with some CD-R drives when piping directly into
.B cdrecord.
In this case it is needed to know the size of the filesystem before the
actual CD-creation is done.
The option \-print-size allows to get this size from a "dry-run" before
the CD is actually written.
.TP
.B \-quiet
This makes
.B mkhybrid
even less verbose.  No progress output will be provided.
.TP
.B \-R
Generate SUSP and RR records using the Rock Ridge protocol to further describe
the files on the iso9660 filesystem.
.TP
.B \-r
This is like the \-R option, but file ownership and modes are set to
more useful values.  The uid and gid are set to zero, because they are
usually only useful on the author's system, and not useful to the
client.  All the file read bits are set true, so that files and
directories are globally readable on the client.  If any execute bit is
set for a file, set all of the execute bits, so that executables are
globally executable on the client.  If any search bit is set for a
directory, set all of the search bits, so that directories are globally
searchable on the client.  All write bits are cleared, because the
CD-Rom will be mounted read-only in any case.  If any of the special
mode bits are set, clear them, because file locks are not useful on a
read-only file system, and set-id bits are not desirable for uid 0 or
gid 0.
When used on Win32, the execute bit is set on
.I all
files. This is a result of the lack of file permissions on Win32 and the
Cygwin POSIX emulation layer.
.TP
.B \-relaxed-filenames
The option
.B \-relaxed-filenames
allows ISO9660 filenames to include digits, uppercase characters
and all other 7 bit ASCII characters (resp. anything except lowercase
characters).
.br
This violates the ISO9660 standard, but it happens to work on many systems.
Use with caution.
.TP
.BI \-sort " sort file
Sort file locations on the media. Sorting is controlled by a file that
contains pairs of filenames and sorting offset weighting.
If the weighting is higher, the file will be located closer to the
beginning of the media, if the weighting is lower, the file will be located
closer to the end of the media.
.TP
.BI \-sysid " ID
Specifies the system ID.
This parameter can also be set in the file
.B \&.m\&kisofsrc
with SYSI=system_id.
If specified in both places, the command line version is used.
.TP
.B \-T
Generate a file TRANS.TBL in each directory on the CDROM, which can be used
on non-Rock Ridge capable systems to help establish the correct file names.
There is also information present in the file that indicates the major and
minor numbers for block and character devices, and each symlink has the name of
the link file given.
.TP
.BI \-table-name " TABLE_NAME
Alternative translation table file name (see above). Implies the
.B \-T
option.
If you are creating a multi-session image you must use the same name
as in the previous session.
.TP
.BI \-ucs-level " level
Set Unicode conformance level in the Joliet SVD. The default level is 3.
It may be set to 1..3 using this option.
.TP
.B \-use-fileversion
The option 
.B \-use-fileversion
allows mkhybrid to use file version numbers from the filesystem.
If the option is not specified, 
.I mkhybrid
creates a version if 1 for all files.
File versions are strings in the range 
.I ";1"
to
.I ";32767"
This option is the default on VMS. 
.TP
.B \-U
Allows "Untranslated" filenames, completely violating the iso9660 standards
described above. Forces on the \-d, \-l, \-L, \-N and \-no-iso-translate
flags, and also allows more
than one '.' character in the filename, as well as mixed case filenames.
This is useful on HP-UX system, where the built-in CDFS filesystem does
not recognize ANY extensions. Use with extreme caution.
.TP
.B \-no-iso-translate
Do not translate the characters '#' and '~' which are invalid for iso9660 filenames.
These characters are though invalid often used by Microsoft systems.
.br
This violates the ISO9660 standard, but it happens to work on many systems.
Use with caution.
.TP
.BI \-V " volid
Specifies the volume ID (volume name or label) to be written into the
master block.  This parameter can also be set in the file
.B \&.m\&kisofsrc
with VOLI=id.
If specified in both places, the command line version is used.  Note that
if you assign a volume ID, this is the name that will be used as the mount
point used by the Solaris volume management system and the name that is
assigned to the disc on a Windows or Mac platform.
.TP
.BI \-volset " ID
Specifies the volset ID.
This parameter can also be set in the file
.B \&.m\&kisofsrc
with VOLS=volset_id.
If specified in both places, the command line version is used.
.TP
.BI \-volset-size " #
Sets the volume set size to #.
The volume set size is the number of CD's that are in a CD set.
The
.B \-volset-size
option may be used to create CD's that are part of e.g. a Operation
System installation set of CD's.
The option
.B \-volset-size
must be specified before
.B \-volset-seqno
on each command line.
.TP
.BI \-volset-seqno " #
Sets the volume set sequence number to #.
The volume set sequence number is the index number of the current
CD in a CD set.
The option
.B \-volset-size
must be specified before
.B \-volset-seqno
on each command line.
.TP
.B \-v
Verbose execution. If given twice on the command line, extra debug information
will be printed.
.TP
.BI \-x " path
Exclude
.I path
from being written to CDROM.
.I path
must be the complete pathname that results from concatenating the pathname
given as command line argument and the path relative to this directory.
Multiple paths may be excluded.
Example: 

mkhybrid \-o cd \-x /local/dir1 \-x /local/dir2 /local
.sp
NOTE: The \-m and \-x option description should both be updated, they are wrong.
Both now work identical and use filename globbing. A file is excluded if either
the last component matches or the whole path matches.
.TP
.B \-z
Generate special SUSP records for transparently compressed files.  This is
only of use and interest for hosts that support transparent decompression.
This is an experimental feature, and no hosts yet support this, but there
are ALPHA patches for Linux that can make use of this feature.
.SH HFS OPTIONS
.TP
.B \-hfs
Create an ISO9660/HFS hybrid CD. This option should be used in conjunction
with the
.BR \-map ,
.I \-magic
and/or the various
.I double dash
options given below.
.TP
.B \-apple
Create an ISO9660 CD with Apple's extensions. Similar to the
.I \-hfs
option, except that the Apple Extensions to ISO9660 are added instead of
creating an HFS hybrid volume.
.TP
.BI \-map " mapping_file
Use the
.I mapping_file
to set the CREATOR and TYPE information for a file based on the
filename's extension. A filename is 
mapped only if it is not one of the know Apple/Unix file formats. See the
.B CREATOR/TYPE
section below.
.TP
.BI \-magic " magic_file
The CREATOR and TYPE information is set by using a file's
.I magic number
(usually the first few bytes of a file). The
.I magic_file
is only used if a file is not one of the known Apple/Unix file formats, or
the filename extension has not been mapped using the
.I \-map
option. See the 
.B CREATOR/TYPE
section below for more details.
.TP
.BI \-hfs-creator " CREATOR
Set the default CREATOR for all files. Must be exactly 4 characters. See the
.B CREATOR/TYPE
section below for more details.
.TP
.BI \-hfs-type " TYPE
Set the default TYPE for all files. Must be exactly 4 characters. See the
.B CREATOR/TYPE
section below for more details.
.TP
.B \-probe
Search the contents of files for all the known Apple/Unix file formats.
See the
.B MACINTOSH FILE FORMATS
section below for more about these formats.
However, the only way to check for
.I MacBinary
and
.I AppleSingle
files is to open and read them. Therefore this option
.I may
increase processing time. It is better to use one or more
.I double dash
options given below if the Apple/Unix formats in use are known.
.TP
.B \-no-desktop
Do not create (empty) Desktop files. New HFS Desktop files will be created
when the CD is used on a Macintosh (and stored in the System Folder).
By default, empty Desktop files are added to the HFS volume.
.TP
.B \-mac-name
Use the HFS filename as the starting point for the ISO9660, Joliet and
Rock Ridge file names. See the
.B MACINTOSH FILE NAMES
section below for more information.
.TP
.BI \-boot-hfs-file " driver_file
Installs the
.I driver_file
that
.I may
make the CD bootable on a Macintosh. See the
.B HFS BOOT DRIVER
section below. (Alpha).
.TP
.B \-part
Generate an HFS partition table. By default, no partition table is generated,
but some older Macintosh CDROM drivers need an HFS partition table on the
CDROM to be able to recognize a hybrid CDROM.
.TP
.BI \-auto " AutoStart_file
Make the HFS CD use the QuickTime 2.0 Autostart feature to launch an
application or document. The given filename must be the name of a document or
application located at the top level of the CD. The filename must be less
than 12 characters. (Alpha).
.TP
.BI \-cluster-size " size
Set the size in bytes of the cluster or allocation units of PC Exchange
files. Implies the
.I \--exchange
option. See the
.B MACINTOSH FILE FORMATS
section below.
.TP
.BI \-hide-hfs " glob
Hide
.I glob
from the HFS volume. The file or directory will still exist in the
ISO9660 and/or Joliet directory.
.I glob
is a shell wild-card-style pattern that must match any part of the filename
Multiple globs may be excluded.
Example:

mkhybrid \-o rom \-hfs \-hide-hfs '*.o' \-hide-hfs foobar

would exclude all files ending in ".o" or called "foobar" 
from the HFS volume. Note that if you had a directory called
"foobar" it too (and of course all its descendants) would be excluded.
The
.I glob
can also be a path name relative to the source directories given on the
command line. Example:

mkhybrid \-o rom \-hfs \-hide-hfs src/html src

would exclude just the file or directory called "html" from the "src"
directory. Any other file or directory called "html" in the tree will
not be excluded.
Should be used with the
.I \-hide
and/or
.I \-hide-joliet
options.
.TP
.BI \-hide-hfs-list " file
A file containing a list of
.I globs
to be hidden as above.
.TP
.BI \-hfs-volid " hfs_volid
Volume name for the HFS partition. This is the name that is
assigned to the disc on a Macintosh and replaces the
.I volid
used with the 
.I \-V
option
.TP
.B \-icon-position
Use the icon position information, if it exists, from the Apple/Unix file.
The icons will appear in the same position as they would on a Macintosh
desktop. Folder location and size on screen, its scroll positions, folder
View (view as Icons, Small Icons, etc.) are also preserved.
This option may become set by default in the future.
(Alpha).
.TP
.BI \-root-info " file
Set the location, size on screen, scroll positions, folder View etc. for the
root folder of an HFS volume. See README.rootinfo for more information.
(Alpha)
.TP
.BI \-prep-boot " FILE
PReP boot image file. Up to 4 are allowed. See README.prep_boot (Alpha)
.TP
.B \--cap
Look for AUFS CAP Macintosh files. Search for CAP Apple/Unix file formats
only. Searching for the other possible Apple/Unix file formats is disabled,
unless other
.I double dash
options are given.
.TP
.B \--netatalk
Look for NETATALK Macintosh files
.TP
.B \--double
Look for AppleDouble Macintosh files
.TP
.B \--ethershare
Look for Helios EtherShare Macintosh files
.TP
.B \--ushare
Look for IPT UShare Macintosh files
.TP
.B \--exchange
Look for PC Exchange Macintosh files
.TP
.B \--sgi
Look for SGI Macintosh files
.TP
.B \--xinet
Look for XINET Macintosh files
.TP
.B \--macbin
Look for MacBinary Macintosh files
.TP
.B \--single
Look for AppleSingle Macintosh files
.TP
.B \--dave
Look for Thursby Software Systems DAVE Macintosh files
.TP
.B \--sfm
Look for Microsoft's Services for Macintosh files (NT only) (Alpha)

.SH CREATOR/TYPE
A Macintosh file has two properties associated with it which define
which application created the file, the
.I CREATOR
and what data the file contains, the
.IR TYPE .
Both are (exactly) 4 letter strings. Usually this
allows a Macintosh user to double-click on a file and launch the correct
application etc. The CREATOR and TYPE of a particular file can be found by
using something like ResEdit (or similar) on a Macintosh.
.LP
The CREATOR and TYPE information is stored in all the various Apple/Unix
encoded files.
For other files it is possible to base the CREATOR and TYPE on the
filename's extension using a
.I mapping
file (the
.I \-map
option) and/or using the
.I magic number
(usually a
.I signature
in the first few bytes)
of a file (the
.I \-magic
option). If both these options are given, then their order on the command
line is important. If the
.I \-map
option is given first, then a filename extension match is attempted
before a magic number match. However, if the
.I \-magic
option is given first, then a magic number match is attempted before a
filename extension match.
.PP
If a mapping or magic file is not used, or no match is found then the default
CREATOR and TYPE for all regular files can be set by using entries in the 
.B \&.m\&kisofsrc
file or using the 
.I \-hfs-creator
and/or
.I \-hfs-type
options, otherwise the default CREATOR and TYPE are 'unix' and 'TEXT'.
.PP
The format of the
.I mapping
file is the same
.I afpfile
format as used by
.IR aufs .
This file has five columns for the
.IR extension ,
.I file
.IR translation ,
.IR CREATOR ,
.I TYPE
and
.IR Comment .
Lines starting with the '#' character are
comment lines and are ignored. An example file would be like:
.LP
.TS
tab (/);
l s s s s
l s s s s
l l l l l .
# Example filename mapping file
#
# EXTN/XLate/CREATOR/TYPE/Comment
\.tif/Raw/'8BIM'/'TIFF'/"Photoshop TIFF image"
\.hqx/Ascii/'BnHq'/'TEXT'/"BinHex file"
\.doc/Raw/'MSWD'/'WDBN'/"Word file"
\.mov/Raw/'TVOD'/'MooV'/"QuickTime Movie"
*/Ascii/'ttxt'/'TEXT'/"Text file"
.TE
.LP
Where:
.IP
The first column
.I EXTN
defines the Unix filename extension to be
mapped. The default mapping for any filename extension that doesn't
match is defined with the "*" character.
.IP
The
.I Xlate
column defines the type of text translation between the Unix and
Macintosh file it is ignored by
.BR mkhybrid ,
but is kept to be compatible with
.BR aufs (1).
Although 
.B mkhybrid
does not alter the contents of a file, if a binary file has it's TYPE
set as 'TEXT', it
.I may
be read incorrectly on a Macintosh. Therefore a better choice for the
default TYPE may be '????'
.IP
The
.I CREATOR
and
.I TYPE
keywords must be 4 characters long and enclosed in single quotes.
.IP
The comment field is enclosed in double quotes - it is ignored by
.BR mkhybrid ,
but is kept to be compatible with 
.BR aufs .
.PP
The format of the
.I magic
file is almost identical to the
.BR magic (4)
file used by the Linux
.BR file (1)
command - the routines for reading and decoding the
.I magic
file are based on the Linux
.BR file (1)
command.
.PP
This file has four tab separated columns for the 
.I byte
.IR offset ,
.IR type ,
.I test
and
.IR message .
Lines starting with the '#' character are
comment lines and are ignored. An example file would be like:
.LP
.TS
tab (/);
l s s s
l s s s
l l l l .
# Example magic file
#
# off/type/test/message
0/string/GIF8/8BIM GIFf  GIF image
0/beshort/0xffd8/8BIM JPEG  image data
0/string/SIT!/SIT! SIT!  StuffIt Archive
0/string/\\037\\235/LZIV ZIVU  standard unix compress
0/string/\\037\\213/GNUz ZIVU  gzip compressed data
0/string/%!/ASPS TEXT  Postscript
0/string/\\004%!/ASPS TEXT  PC Postscript with a ^D to start
4/string/moov/txtt MooV  QuickTime movie file (moov)
4/string/mdat/txtt MooV  QuickTime movie file (mdat)
.TE
.PP
The format of the file is described in the
.BR magic (4)
man page. The only difference here is that for each entry in the magic file, the
.I message
for the initial offset
.B must
be 4 characters for the CREATOR followed by 4 characters for the TYPE -
white space is
optional between them. Any other characters on this line are ignored.
Continuation lines (starting with a '>') are also ignored i.e. only the initial
offset lines are used.
.PP
Using the
.I \-magic
option may significantly increase processing time as each file has to opened
and read to find it's magic number.
.PP
In summary, for all files, the default CREATOR is 'unix' and the default
TYPE is 'TEXT'.  These can be changed by using entries in the 
.I \&.m\&kisofsrc 
file or by using the
.I \-hfs-creator
and/or
.I \-hfs-type
options. 
.PP
If the a file is in one of the known Apple/Unix formats (and the format
has been selected), then the CREATOR and TYPE are taken from the values
stored in the Apple/Unix file.
.PP
Other files can have their CREATOR and TYPE set from their file name
extension (the
.I \-map
option), or their magic number (the
.I \-magic
option). If the default match is used in the
.I mapping
file, then these values override the default CREATOR and TYPE.
.PP
A full CREATOR/TYPE database can be found at 
http://www.angelfire.com/il/szekely/index.html

.SH MACINTOSH FILE FORMATS
Macintosh files have two parts called the
.I Data
and
.I Resource
fork. Either may be empty. Unix (and many other OSs) can only
cope with files having one part (or fork). To add to this, Macintosh files
have a number of attributes associated with them - probably the most
important are the TYPE and CREATOR. Again Unix has no concept of these
types of attributes.
.PP
e.g. a Macintosh file may be a JPEG image where the image is stored in the
Data fork and a desktop thumbnail stored in the Resource fork. It is usually
the information in the data fork that is useful across platforms.
.PP
Therefore to store a Macintosh file on a Unix filesystem, a way has to be
found to cope with the two forks and the extra attributes (which are
referred to as the
.I finder
.IR info ).
Unfortunately, it seems that every software package that stores Macintosh
files on Unix has chosen a completely different storage method.
.PP
The Apple/Unix formats that
.I mkhybrid
(partially) supports are:
.IP "CAP AUFS format"
Data fork stored in a file. Resource fork in subdirectory .resource
with same filename as data fork. Finder info
in .finderinfo subdirectory with same filename.
.IP "AppleDouble/Netatalk"
Data fork stored in a file. Resource fork stored in a file with
same name prefixed with "%". Finder info also stored in same
"%" file. Netatalk uses the same format, but the resource
fork/finderinfo stored in subdirectory .AppleDouble with same
name as data fork.
.IP AppleSingle
Data structures similar to above, except both forks and finder
info are stored in one file.
.IP "Helios EtherShare"
Data fork stored in a file. Resource fork and finder info together in
subdirectory .rsrc with same filename as data fork.
.IP "IPT UShare"
Very similar to the EtherShare format, but the finder info
is stored slightly differently.
.IP MacBinary
Both forks and finder info stored in one file.
.IP "Apple PC Exchange"
Used by Macintoshes to store Apple files on DOS (FAT) disks.
Data fork stored in a file. Resource fork in subdirectory
resource.frk (or RESOURCE.FRK). Finder info as one record
in file finder.dat (or FINDER.DAT). Separate finder.dat for
each data fork directory.
.IP
Note: 
.I mkhybrid
needs to know the native FAT cluster size of the disk that the PC Exchange
files are on (or have been copied from). This size is given by the
.I \-cluster-size
option.
The cluster or allocation size can be found by using the DOS utility
.BR CHKDSK .
.IP
May not work with PC Exchange v2.2 or higher files (available with MacOS 8.1).
DOS media containing PC Exchange files should be mounted as type
.B msdos
(not
.BR vfat )
when using Linux.
.IP "SGI/XINET"
Used by SGI machines when they mount HFS disks. Data fork stored
in a file. Resource fork in subdirectory .HSResource with same
name. Finder info as one record in file .HSancillary. Separate .HSancillary
for each data fork directory.
.IP "Thursby Software Systems DAVE"
Allows Macintoshes to store Apple files on SMB servers.
Data fork stored in a file. Resource fork in subdirectory
resource.frk. Uses the AppleDouble format to store resource fork.
.IP "Services for Macintosh"
Format of files stored by NT Servers on NTFS filesystems. Data fork is
stored as "filename". Resource fork stored as a NTFS
.I stream
called "filename:AFP_Resource". The finder info is stored as a NTFS
.I stream
called "filename:Afp_AfpInfo". These streams are normally invisible to the
user.
.IP
Warning: mkhybrid only partially supports the SFM format. If an HFS file
or folder stored on the NT server contains an
.I illegal
NT character in its name, then NT converts these characters to
.I Private Use Unicode
characters. The characters are: " * / < > ? \ | also a space or
period if it is the last character of the file name, character codes 0x01
to 0x1f (control characters) and Apple' apple logo.
.IP
Unfortunately, these private Unicode characters are not
readable by the mkhybrid NT executable. Therefore any file or directory
name containing these characters will be ignored - including the contents of
any such directory.
.LP
.I mkhybrid
will attempt to set the CREATOR, TYPE, date and possibly other flags from
the finder info. Additionally, if it exists, the Macintosh filename is set
from the finder info, otherwise the Macintosh name is based on the Unix
filename - see the MACINTOSH FILE NAMES section below.
.PP
When using the
.I \-apple
option, the TYPE and CREATOR are stored in the optional System Use or SUSP field
in the ISO9660 Directory Record - in much the same way as the Rock Ridge
attributes are. In fact to make life easy, the Apple extensions are added
at the beginning of the existing Rock Ridge attributes (i.e. to get the Apple
extensions you get the Rock Ridge extensions as well).
.PP
The Apple extensions require the resource fork to be stored as an ISO9660
.I associated
file. This is just like any normal file stored in the ISO9660 filesystem
except that the associated file flag is set in the Directory Record (bit
2). This file has the same name as the data fork (the file seen by
non-Apple machines). Associated files are normally ignored by other OSs
.PP
When using the
.I \-hfs
option, the TYPE and CREATOR plus other finder info, are stored in a separate
HFS directory, not visible on the ISO9660 volume. The HFS directory references
the same data and resource fork files described above.
.PP
In most cases, it is better to use the
.I \-hfs
option instead of the
.I \-apple
option, as the latter imposes the limited ISO9660 characters allowed in
filenames. However, the Apple extensions do give the advantage that the
files are packed on the disk more efficiently and it may be possible to fit 
more files on a CD - important when the total size of the source files is
approaching 650MB.



.SH MACINTOSH FILE NAMES
Where possible, the HFS filename that is stored with an Apple/Unix file
is used for the HFS part of the CD. However, not all the Apple/Unix
encodings store the HFS filename with the finderinfo. In these cases,
the Unix filename is used - with escaped special characters. Special
characters include '/' and characters with codes over 127.
.PP
Aufs escapes these characters by using ":" followed by the character code
as two hex digits. Netatalk and EtherShare have a similar scheme, but uses
"%" instead of a ":".
.PP
If mkhybrid can't find an HFS filename, then it uses the Unix name, with
any %xx or :xx characters (xx == two hex digits) converted to a single
character code. If "xx" are not hex digits ([0-9a-fA-F]), then they are
left alone - although any remaining ":" is converted to "%" as colon
is the HFS directory separator. Care must be taken, as an ordinary Unix
file with %xx or :xx will also be converted. e.g.
.PP
.TS
l l 
l s
l l
l s
l l .
This:2fFile	converted to This/File
	
This:File	converted to This%File
	
This:t7File	converted to This%t7File
.TE
.PP
Although HFS filenames appear to support upper and lower case letters,
the filesystem is case insensitive. i.e. the filenames "aBc" and "AbC"
are the same. If a file is found in a directory with the same HFS name,
then
.I mkhybrid
will attempt, where possible, to make a unique name by adding '_' characters
to one of the filenames. 
.PP
If an HFS filename exists for a file, then mkhybrid can use this name as
the starting point for the ISO9660, Joliet and Rock Ridge filenames using
the
.I \-mac-name
option. Normal Unix files without an HFS name will still use their Unix name.
e.g.
.PP
If a
.I MacBinary
(or
.I PC
.IR Exchange )
file is stored as 
.I someimage.gif.bin
on the Unix filesystem, but contains a HFS file called
.IR someimage.gif ,
then this is the name that would appear on the HFS part of the CD. However, as
mkhybrid uses the Unix name as the starting point for the other names, then
the ISO9660 name generated will probably be 
.I SOMEIMAG.BIN
and the Joliet/Rock Ridge would be
.IR someimage.gif.bin .
Although the actual data (in this case) is a GIF image. This option will use
the HFS filename as the starting point and the ISO9660 name will probably be
.I SOMEIMAG.GIF
and the Joliet/Rock Ridge would be
.IR someimage.gif .
.PP
Using the
.I \-mac-name
option will not currently work with the
.I \-T
option - the Unix
name will be used in the TRANS.TBL file, not the Macintosh name.
.PP
The existing mkhybrid code will filter out any illegal characters for the
ISO9660 and Joliet filenames, but as mkhybrid expects to be dealing
directly with Unix names, it leaves the Rock Ridge names as is.
But as '/' is a legal HFS filename character, the
.I \-mac-name
option coverts '/' to a '_' in a Rock Ridge filenames.
.PP
If the Apple extensions are used, then only the ISO9660 filenames will
appear on the Macintosh. However, as the Macintosh ISO9660 drivers can use
.I Level 2
filenames, then you can use the
.I \-l
option without problems on
a Macintosh - still take care over the names, for example
.I this.file.name
will be converted to
.I THIS.FILE
i.e. only have one '.', also filename
.I abcdefgh
will be seen as
.I ABCDEFGH
but
.I abcdefghi
will be seen as
.I ABCDEFGHI.
i.e. with a '.' at the end - don't know if this is a Macintosh
problem or m\&kisofs/mkhybrid problem. All filenames will be in uppercase
when viewed on a Macintosh. Of course, DOS/Win3.X machines will not be able
to see Level 2 filenames...

.SH CUSTOM VOLUME/FOLDER ICONS
To give a HFS CD a custom icon, make sure the root (top level) folder includes
a standard Macintosh volume icon file. To give a volume a custom icon on
a Macintosh, an icon has to be pasted over the volume's icon in the "Get Info"
box of the volume. This creates an invisible file called 'Icon\\r' ('\\r' is
the 'carriage return' character) in the root folder.
.P
A custom folder icon is very similar - an invisible file called 'Icon\\r'
exits in the folder itself.
.P
Probably the easiest way to create a custom icon that mkhybrid can use, is to
format a blank HFS floppy disk on a Mac, paste an icon to its "Get Info"
box. If using Linux with the HFS module installed, mount the floppy using
something like:

	mount \-t hfs /dev/fd0 /mnt/floppy

The floppy will be mounted as a CAP file system by default. Then run mkhybrid
using something like:

	mkhybrid \--cap \-o output source_dir /mnt/floppy

If you are not using Linux, then you can use the hfsutils to copy the icon
file from the floppy. However, care has to be taken, as the icon file
contains a control character. e.g.

	hmount /dev/fd0
.br
	hdir \-a
.br
	hcopy \-m Icon^V^M icon_dir/icon

Where '^V^M' is control-V followed by control-M. Then run 
.B mkhybrid
by using something like:

	mkhybrid \--macbin \-o output source_dir icon_dir
.PP
The procedure for creating/using custom folder icons is very similar - paste
an icon to folder's "Get Info" box and transfer the resulting 'Icon\\r'
file to the relevant directory in the mkhybrid source tree.
.PP
You may want to hide the icon files from the ISO9660 and Joliet trees.
.PP
To give a custom icon to a Joliet CD, follow the instructions found at:
http://www.fadden.com/cdrfaq/faq03.html#[3-21]

.SH HFS BOOT DRIVER
It 
.I may
be possible to make the hybrid CD bootable on a Macintosh.
.PP
A bootable HFS CD requires an Apple CD-ROM (or compatible) driver, a bootable
HFS partition and the necessary System, Finder, etc. files.
.PP
A driver can be obtained from any other Macintosh bootable CD-ROM using the
.I apple_driver
utility. This file can then be used with the
.I \-boot-hfs-file
option.
.PP
The HFS partition (i.e. the hybrid disk in our case) must contain a
suitable System Folder, again from another CD-ROM or disk.
.PP
For a partition to be bootable, it must have it's 
.I boot block
set. The boot
block is in the first two blocks of a partition. For a non-bootable partition
the boot block is full of zeros. Normally, when a System file is copied to
partition on a Macintosh disk, the boot block is filled with a number of
required settings - unfortunately I don't know the full spec for the boot
block, so I'm guessing that the following will work OK.
.PP
Therefore, the utility
.I apple_driver
also extracts the boot block from the
first HFS partition it finds on the given CD-ROM and this is used for the
HFS partition created by
.BR mkhybrid .
.IP "PLEASE NOTE"
By using a driver from an Apple CD and copying Apple software to your CD,
you become liable to obey Apple Computer, Inc. Software License Agreements.
.SH BOOT INFORMATION TABLE
When the
.B \-boot-info-table
option is given,
.B mkhybrid
will modify the boot file specified by the
.B \-b
option by inserting a 56-byte "boot information table" at offset 8 in
the file.  This modification is done in the source filesystem, so make
sure you use a copy if this file is not easily recreated!  This file
contains pointers which may not be easily or reliably obtained at boot
time.
.PP
The format of this table is as follows; all integers are in
section 7.3.1 ("little endian") format.
.sp
.RS +.2i
.ta 1.0i 2.5i 3.5i
.nf
Offset	Name	Size	Meaning
 8	bi_pvd	4 bytes	LBA of primary volume descriptor
12	bi_file	4 bytes	LBA of boot file
16	bi_length	4 bytes	Boot file length in bytes
20	bi_csum	4 bytes	32-bit checksum
24	bi_reserved	40 bytes	Reserved
.fi
.RE
.sp
The 32-bit checksum is the sum of all the 32-bit words in the boot
file starting at byte offset 64.  All linear block addresses (LBAs)
are given in CD sectors (normally 2048 bytes).
.SH CONFIGURATION
.B mkhybrid
looks for the
.B \&.m\&kisofsrc
file,
first in the current working directory,
then in the user's home directory,
and then in the directory in which the
.B mkhybrid
binary is stored.  This file is assumed to contain a series of lines
of the form
.BI TAG= value,
and in this way you can specify certain options.
The case of the tag is not significant.
Some fields in the volume header
are not settable on the command line, but can be altered through this
facility.
Comments may be placed in this file,
using lines which start with a hash (#) character.
.TP
.B APPI
The application identifier
should describe the application that will be on the disc.
There is space on the disc for 128 characters of information.
May be overridden using the
.B \-A
command line option.
.TP
.B COPY
The copyright information,
often the name of a file on the disc containing the copyright notice.
There is space in the disc for 37 characters of information.
May be overridden using the
.B \-copyright
command line option.
.TP
.B ABST
The abstract information,
often the name of a file on the disc containing an abstract.
There is space in the disc for 37 characters of information.
May be overridden using the
.B \-abstract
command line option.
.TP
.B BIBL
The bibliographic information,
often the name of a file on the disc containing a bibliography.
There is space in the disc for 37 characters of information.
May be overridden using the
.B \-bilio
command line option.
.TP
.B PREP
This should describe the preparer of the CDROM,
usually with a mailing address and phone number.
There is space on the disc for 128 characters of information.
May be overridden using the
.B \-p
command line option.
.TP
.B PUBL
This should describe the publisher of the CDROM,
usually with a mailing address and phone number.
There is space on the disc for 128 characters of information.
May be overridden using the
.B \-P
command line option.
.TP
.B SYSI
The System Identifier.
There is space on the disc for 32 characters of information.
May be overridden using the
.B \-sysid
command line option.
.TP
.B VOLI
The Volume Identifier.
There is space on the disc for 32 characters of information.
May be overridden using the
.B \-V
command line option.
.TP
.B VOLS
The Volume Set Name.
There is space on the disc for 128 characters of information.
May be overridden using the
.B \-volset
command line option.
.TP
.B HFS_TYPE
The default TYPE for Macintosh files. Must be exactly 4 characters.
May be overridden using the
.B \-hfs-type
command line option.
.TP
.B HFS_CREATOR
The default CREATOR for Macintosh files. Must be exactly 4 characters.
May be overridden using the
.B \-hfs-creator
command line option.
.PP
.B mkhybrid
can also be configured at compile time with defaults for many of these fields.
See the file defaults.h.
.SH EXAMPLES
To create a HFS hybrid CD with the Joliet and Rock Ridge extensions of
the source directory cd_dir:
.PP
% mkhybrid \-o cd.iso \-r \-J \-hfs cd_dir
.PP
To create a HFS hybrid CD from the source directory cd_dir that contains
Netatalk Apple/Unix files:
.PP
% mkhybrid \-o cd.iso \--netatalk cd_dir
.PP
To create a HFS hybrid CD from the source directory cd_dir, giving all files
CREATOR and TYPES based on just their filename extensions listed in the file 
"mapping".:
.PP
% mkhybrid \-o cd.iso \-map mapping cd_dir
.PP
To create a CD with the 'Apple Extensions to ISO9660', from the source
directories cd_dir and another_dir. Files in all the known Apple/Unix format
are decoded and any other files are given CREATOR and TYPE based on their
magic number given in the file "magic":
.PP
% mkhybrid \-o cd.iso \-apple \-magic magic \-probe \\
.br
        cd_dir another_dir
.PP
The following example puts different files on the CD that all have
the name README, but have different contents when seen as a
ISO9660/RockRidge, Joliet or HFS CD.
.PP
Current directory contains:
.PP
% ls \-F
.br
README.hfs     README.joliet  README.unix    cd_dir/
.PP
The following command puts the contents of the directory "cd_dir" on the
CD along with the three README files - but only one will be seen from
each of the three filesystems:
.PP
% mkhybrid \-o cd.iso \-hfs \-J \-r \\
.br
        \-hide README.hfs \-hide README.joliet \\
.br
        \-hide-joliet README.hfs \-hide-joliet README.unix \\
.br
        \-hide-hfs README.joliet \-hide-hfs README.unix \\
.br
        README=README.hfs README=README.joliet \\
.br
        README=README.unix cd_dir
.PP
i.e. the file README.hfs will be seen as README on the HFS CD and the
other two README files will be hidden. Similarly for the Joliet and
ISO9660/RockRidge CD.
.PP
There are probably all sorts of strange results possible with
combinations of the hide options ...
.SH AUTHOR
.B m\&kisofs
is not based on the standard mk*fs tools for unix, because we must generate
a complete  copy of an existing filesystem on a disk in the  iso9660
filesystem.  The name m\&kisofs is probably a bit of a misnomer, since it
not only creates the filesystem, but it also populates it as well.
.PP
.br
Eric Youngdale <ericy@gnu.ai.mit.edu> or <eric@andante.org> wrote both the
Linux isofs9660 filesystem and the m\&kisofs utility.
The copyright for the m\&kisofs utility is held by
Yggdrasil Computing, Incorporated.
.PP
.B mkhybrid
is based on
.B m\&kisofs
and works in exactly the same way as
.B m\&kisofs
without the HFS options. The change in name is to signify that it does
something extra. If you do not need the HFS options, then you should
really be using
.BR m\&kisofs .
.PP
HFS hybrid code Copyright (C) James Pearson 1997, 1998, 1999, 2000
.br
libhfs code Copyright (C) 1996, 1997 Robert Leslie
.br
libfile code Copyright (C) Ian F. Darwin 1986, 1987, 1989, 1990, 1991,
1992, 1994, 1995.
.SH NOTES
.B Mkhybrid
may safely be installed suid root. This may be needed to allow
.B mkhybrid
to read the previous session when creating a multi session image.
.SH BUGS
.TP
\(bu
Any files that have hard links to files not in the tree being copied to the
iso9660 filesystem will have an incorrect file reference count.
.TP
\(bu
Does not check for SUSP record(s) in "." entry of the
root directory to verify the existence of Rock Ridge
enhancements.
.sp
This problem is present when reading old sessions while
adding data in multi-session mode.
.TP
\(bu
Does not properly read relocated directories in multi-session
mode when adding data.
.sp
Any relocated deep directory is lost if the new session does not
include the deep directory.
.sp
Repeat by: create first session with deep directory relocation
then add new session with a single dir that differs from the
old deep path.
.TP
\(bu
Does not re-use RR_MOVED when doing multi-session from TRANS.TBL
.TP
\(bu
Does not create whole_name entry for RR_MOVED in multi-session
mode.
.PP
There may be some other ones.  Please, report them to the author.

.SH HFS PROBLEMS/LIMITATIONS
I have had to make several assumptions on how I expect the modified
libhfs routines to work, however there may be situations that either
I haven't thought of, or come across when these assumptions fail.
Therefore I can't guarantee that mkhybrid will work as expected
(although I haven't had a major problem yet). Most of the HFS features work
fine, however, some are not fully tested. These are marked as
.I Alpha
above.
.PP
Although HFS filenames appear to support upper and lower case letters,
the filesystem is case insensitive. i.e. the filenames "aBc" and "AbC"
are the same. If a file is found in a directory with the same HFS name, then
.I mkhybrid
will attempt, where possible, to make a unique name by adding '_' characters
to one of the filenames.
.PP
HFS file/directory names that share the first 31 characters have
_N' (N == decimal number) substituted for the last few characters
to generate unique names.
.PP
Care must be taken when "grafting" Apple/Unix files or directories (see
above for the method and syntax involved). It is not possible to use a
new name for an Apple/Unix encoded file/directory. e.g. If a Apple/Unix
encoded file called "oldname" is to added to the CD, then you can not use
the command line:
.IP
mkhybrid \-o output.raw \-hfs newname=oldname cd_dir
.LP
mkhybrid will be unable to decode "oldname". However, you can graft
Apple/Unix encoded files or directories as long as you do not attempt to
give them new names as above.
.PP
When creating an HFS volume with the multisession options,
.B \-M
and
.BR \-C ,
only files in the last session will be in the HFS volume. i.e. mkhybrid can
not
.I add
existing files from previous sessions to the HFS volume.
.PP
Symbolic links (as with all other non-regular files) are not added to
the HFS directory.
.PP
Hybrid volumes may be larger than pure ISO9660 volumes
containing the same data.
.PP
The resulting hybrid volume can be accessed on a Unix machine by using
the hfsutils routines. However, no changes should be made to the
contents of the volume as it's not a "real" HFS volume.
.PP
Using the
.B \-mac-name
option will not currently work with the
.B \-T
option - the Unix
name will be used in the TRANS.TBL file, not the Macintosh name.
.PP
Although 
.B mkhybrid
does not alter the contents of a file, if a binary file has it's TYPE
set as 'TEXT', it
.I may
be read incorrectly on a Macintosh. Therefore a better choice for the
default TYPE may be '????'
.PP
The
.B \-mac-boot-file
option may not work at all...
.PP
May not work with PC Exchange v2.2 or higher files (available with MacOS 8.1).
DOS media containing PC Exchange files should be mounted as type
.B msdos
(not
.BR vfat )
when using Linux.
.PP
The SFM format is only partially supported - see MACINTOSH FILE FORMATS
section above.
.PP
It is not possible to use the the
.I \-sparc-boot
or
.I \-generic-boot
options with the 
.I \-boot-hfs-file
or
.I \-prep-boot
options.

.SH SEE ALSO
.BR m\&kisofs (8),
.BR magic (5),
.BR apple_driver (8)
.SH FUTURE IMPROVEMENTS
Some sort of gui interface.
.SH AVAILABILITY
.B m\&kisofs
is available as part of the cdrecord package from
ftp://ftp.fokus.gmd.de/pub/unix/cdrecord/
.PP
.B mkhybrid
is available from ftp://ftp.ge.ucl.ac.uk/pub/mkhfs and
.B hfsutils
from ftp://ftp.mars.org/pub/hfs
.SH "MAILING LISTS
If you want to actively take part on the development of m\&kisofs,
and/or mkhybrid,
you may join the cdwriting mailing list by sending mail to:
.nf
.sp
	other-cdwrite-request@lists.debian.org
.sp
.fi
and include the word
.I subscribe
in the body.
The mail address of the list is:
.nf
.sp
	cdwrite@lists.debian.org
.fi

.SH MKHYBRID MAINTAINER
James Pearson
.PP
j.pearson@ge.ucl.ac.uk

.SH M\&KISOFS MAINTAINER
.nf
J\*org Schilling
Seestr. 110
D-13353 Berlin
Germany
.fi
.PP
Mail bugs and suggestions to:
.PP
.B
schilling@fokus.gmd.de
or
.B
js@cs.tu-berlin.de
or
.B
joerg@schily.isdn.cs.tu-berlin.de
